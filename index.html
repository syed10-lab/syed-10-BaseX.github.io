<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BaseX Console</title>
  <style>
    :root {
      --green: #0A6847;   /* Madina Green */
      --blue: #1E90FF;    /* Blue */
      --gold: #FFD700;    /* Golden */
      --white: #FFFFFF;   /* White */
      --bg: #F4F7FA;      /* Light bg */
      --card: #FFFFFF;
      --shadow: rgba(0,0,0,0.12);
      --text-dark: #222;
      --text-light: #777;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      display: flex;
      color: var(--text-dark);
    }

    /* ---------- SIDEBAR ---------- */
    .sidebar {
      width: 260px;
      background: var(--green);
      color: var(--white);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 15px var(--shadow);
      padding-top: 16px;
    }

    .sidebar .brand {
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      padding: 12px 0 20px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }

    .sidebar .brand span {
      display: block;
      font-size: 12px;
      font-weight: 500;
      opacity: 0.9;
    }

    .nav-link {
      padding: 14px 22px;
      font-size: 15px;
      text-decoration: none;
      color: var(--white);
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 4px solid transparent;
      transition: 0.2s;
    }

    .nav-link:hover {
      background: rgba(255,255,255,0.14);
      border-left-color: var(--gold);
    }

    .nav-link.active {
      background: rgba(255,255,255,0.18);
      border-left-color: var(--gold);
      font-weight: 600;
    }

    .nav-link span.icon {
      width: 18px;
      text-align: center;
    }

    /* ---------- MAIN WRAPPER ---------- */
    .main {
      margin-left: 260px;
      padding: 24px 28px;
      width: 100%;
      min-height: 100vh;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
    }

    .topbar h1 {
      margin: 0;
      font-size: 26px;
    }

    .topbar .badge {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(14, 166, 107, 0.12);
      color: var(--green);
      font-size: 12px;
      font-weight: 600;
    }

    /* ---------- SECTIONS ---------- */
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    /* DASHBOARD */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 20px 18px;
      box-shadow: 0px 8px 18px var(--shadow);
    }

    .card-title {
      font-size: 15px;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .card-value {
      font-size: 30px;
      font-weight: 700;
      color: var(--blue);
    }

    .card-footer {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
    }

    .label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
    }

    .table th, .table td {
      padding: 8px 10px;
      border-bottom: 1px solid #e2e2e2;
    }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(30,144,255,0.1);
      color: var(--blue);
      font-weight: 500;
    }

    .btn {
      border: none;
      padding: 9px 14px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: 0.15s;
    }

    .btn-primary {
      background: var(--blue);
      color: var(--white);
    }
    .btn-primary:hover {
      background: #1874d0;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid #ddd;
      color: var(--text-dark);
    }
    .btn-ghost:hover {
      background: #eee;
    }

    input, select {
      padding: 7px 9px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
      width: 100%;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 8px;
    }

    .form-row > div {
      flex: 1;
    }

    .small-text {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 6px;
    }

    .loader {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 3px solid var(--blue);
      border-top-color: transparent;
      animation: spin 0.7s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .text-center { text-align:center; }
    .mt-16 { margin-top:16px; }
    .mt-8 { margin-top:8px; }

    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,215,0,0.14);
      color: var(--green);
    }

    /* TEMP "Coming soon" */
    .coming-soon {
      text-align: center;
      padding: 60px 0;
      color: var(--text-light);
      font-size: 14px;
    }

    .coming-soon span {
      display:block;
      font-size:26px;
      margin-bottom:6px;
      color: var(--green);
      font-weight:700;
    }

  </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="brand">
    BaseX
    <span>Firebase-style Console</span>
  </div>
  <a class="nav-link active" data-section="dashboard">
    <span class="icon">üè†</span> Dashboard
  </a>
  <a class="nav-link" data-section="users">
    <span class="icon">üë§</span> Users
  </a>
  <a class="nav-link" data-section="database">
    <span class="icon">üóÇ</span> Database
  </a>
  <a class="nav-link" data-section="storage">
    <span class="icon">üß≥</span> Storage
  </a>
  <a class="nav-link" data-section="analytics">
    <span class="icon">üìä</span> Analytics
  </a>
  <a class="nav-link" data-section="settings">
    <span class="icon">‚öôÔ∏è</span> Settings
  </a>
</div>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <h1 id="pageTitle">Dashboard</h1>
    <div class="badge">BaseX ‚Ä¢ Madina Green Theme</div>
  </div>

  <!-- DASHBOARD SECTION -->
  <div class="section active" id="section-dashboard">
    <div class="grid">
      <div class="card">
        <div class="card-title">Total Users</div>
        <div id="dashTotalUsers" class="card-value">
          <div class="loader"></div>
        </div>
        <div class="card-footer">From BaseX Auth (users collection)</div>
      </div>

      <div class="card">
        <div class="card-title">Database Collections</div>
        <div class="card-value">‚Äì</div>
        <div class="card-footer small-text">
          For now, tracking <span class="pill">users</span> collection.  
          More coming soon (orders, projects, etc.)
        </div>
      </div>

      <div class="card">
        <div class="card-title">Server Status</div>
        <div class="card-value" style="color:var(--green)">ONLINE</div>
        <div class="card-footer small-text">
          Connected to your BaseX backend on Replit.
        </div>
      </div>
    </div>

    <div class="mt-16 card">
      <div class="label">Recent Users</div>
      <table class="table" id="dashUsersTable">
        <thead>
          <tr>
            <th>Email</th>
            <th>Name</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="3" class="text-center">Loading‚Ä¶</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- USERS SECTION -->
  <div class="section" id="section-users">
    <div class="card" style="margin-bottom:16px;">
      <div class="label">Create New User (BaseX Auth)</div>
      <div class="form-row">
        <div>
          <div class="label">Name</div>
          <input id="newUserName" placeholder="User name">
        </div>
        <div>
          <div class="label">Email</div>
          <input id="newUserEmail" placeholder="user@example.com">
        </div>
        <div>
          <div class="label">Password</div>
          <input id="newUserPassword" placeholder="password">
        </div>
      </div>
      <button class="btn btn-primary" onclick="createUser()">Create User</button>
      <div id="createUserMsg" class="small-text mt-8"></div>
    </div>

    <div class="card">
      <div class="label">
        All Users
        <button class="btn btn-ghost" style="float:right;" onclick="loadUsersList()">Refresh</button>
      </div>
      <table class="table" id="usersTable">
        <thead>
          <tr>
            <th>UserID</th>
            <th>Email</th>
            <th>Name</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="3" class="text-center">Loading‚Ä¶</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- DATABASE SECTION -->
  <div class="section" id="section-database">
    <div class="card">
      <div class="label">Read Collection (BaseX DB)</div>
      <div class="form-row">
        <div>
          <div class="label">Collection Name</div>
          <input id="dbCollection" placeholder="e.g. users, orders, projects">
        </div>
        <div style="align-self:flex-end;">
          <button class="btn btn-primary" onclick="loadCollection()">Load Collection</button>
        </div>
      </div>
      <div id="dbMsg" class="small-text"></div>

      <table class="table mt-8" id="dbTable">
        <thead>
          <tr>
            <th>Doc ID</th>
            <th>Data (JSON)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="2" class="text-center">No data yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- STORAGE SECTION -->
  <div class="section" id="section-storage">
    <div class="card coming-soon">
      <span>Storage Coming Soon</span>
      You will be able to upload files (images, PDFs, media) with unlimited capacity ‚Äì all on your BaseX backend.
    </div>
  </div>

  <!-- ANALYTICS SECTION -->
  <div class="section" id="section-analytics">
    <div class="card coming-soon">
      <span>Analytics Coming Soon</span>
      Realtime active users, events, funnels, and charts ‚Äì just like Firebase Analytics, but with no limits.
    </div>
  </div>

  <!-- SETTINGS SECTION -->
  <div class="section" id="section-settings">
    <div class="card">
      <div class="label">BaseX Project Settings</div>
      <p class="small-text">
        Backend URL (Replit):
      </p>
      <p class="pill" id="backendUrlDisplay"></p>
      <p class="small-text">
        In future: multiple projects, API keys, environment separation (dev / prod) ‚Äì and all under your control.
      </p>
    </div>
  </div>

</div>


<script>
  // ============================
  // CONFIG: YOUR BASEX URL
  // ============================
  const BASEX_URL = "https://4f9801a3-b73c-45f9-ac7c-6d650d5dab43-00-3imlod1ughss4.sisko.repl.co";

  // Show backend URL in Settings
  document.getElementById("backendUrlDisplay").innerText = BASEX_URL;

  // ============================
  // NAVIGATION HANDLING
  // ============================
  const navLinks = document.querySelectorAll(".nav-link");
  const sections = {
    dashboard: document.getElementById("section-dashboard"),
    users: document.getElementById("section-users"),
    database: document.getElementById("section-database"),
    storage: document.getElementById("section-storage"),
    analytics: document.getElementById("section-analytics"),
    settings: document.getElementById("section-settings")
  };
  const pageTitle = document.getElementById("pageTitle");

  navLinks.forEach(link => {
    link.addEventListener("click", () => {
      navLinks.forEach(l => l.classList.remove("active"));
      link.classList.add("active");

      const target = link.getAttribute("data-section");
      Object.keys(sections).forEach(key => {
        sections[key].classList.remove("active");
      });
      sections[target].classList.add("active");

      pageTitle.innerText = target.charAt(0).toUpperCase() + target.slice(1);
    });
  });

  // ============================
  // DASHBOARD ‚Äì TOTAL USERS + RECENT USERS
  // ============================
  async function loadDashboard() {
    try {
      const res = await fetch(`${BASEX_URL}/api/users`);
      const data = await res.json();

      if (!data || !data.users) {
        document.getElementById("dashTotalUsers").innerText = "0";
        document.querySelector("#dashUsersTable tbody").innerHTML =
          "<tr><td colspan='3' class='text-center'>No users yet.</td></tr>";
        return;
      }

      const users = data.users;
      document.getElementById("dashTotalUsers").innerText = users.length;

      let rows = "";
      users.slice(-5).reverse().forEach(u => {
        rows += `
          <tr>
            <td>${u.email || "-"}</td>
            <td>${u.name || "-"}</td>
            <td>${u.createdAt || "-"}</td>
          </tr>
        `;
      });
      if (!rows) {
        rows = "<tr><td colspan='3' class='text-center'>No users yet.</td></tr>";
      }
      document.querySelector("#dashUsersTable tbody").innerHTML = rows;

    } catch (err) {
      document.getElementById("dashTotalUsers").innerText = "ERR";
      document.querySelector("#dashUsersTable tbody").innerHTML =
        "<tr><td colspan='3' class='text-center'>Error loading users.</td></tr>";
    }
  }

  // ============================
  // USERS ‚Äì LIST + CREATE
  // ============================
  async function loadUsersList() {
    try {
      const res = await fetch(`${BASEX_URL}/api/users`);
      const data = await res.json();
      const tbody = document.querySelector("#usersTable tbody");

      if (!data || !data.users || !data.users.length) {
        tbody.innerHTML = "<tr><td colspan='3' class='text-center'>No users found.</td></tr>";
        return;
      }

      let rows = "";
      data.users.forEach(u => {
        rows += `
          <tr>
            <td>${u.id || u.userId || "-"}</td>
            <td>${u.email || "-"}</td>
            <td>${u.name || "-"}</td>
          </tr>
        `;
      });
      tbody.innerHTML = rows;
    } catch (err) {
      document.querySelector("#usersTable tbody").innerHTML =
        "<tr><td colspan='3' class='text-center'>Error loading users.</td></tr>";
    }
  }

  async function createUser() {
    const name = document.getElementById("newUserName").value.trim();
    const email = document.getElementById("newUserEmail").value.trim();
    const password = document.getElementById("newUserPassword").value.trim();
    const msg = document.getElementById("createUserMsg");

    if (!name || !email || !password) {
      msg.innerText = "Please fill all fields.";
      msg.style.color = "red";
      return;
    }

    msg.innerText = "Creating user...";
    msg.style.color = "#444";

    try {
      const res = await fetch(`${BASEX_URL}/api/users`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, password })
      });
      const data = await res.json();
      if (data.success) {
        msg.innerText = "User created: " + data.userId;
        msg.style.color = "green";
        document.getElementById("newUserName").value = "";
        document.getElementById("newUserEmail").value = "";
        document.getElementById("newUserPassword").value = "";
        loadUsersList();
        loadDashboard();
      } else {
        msg.innerText = data.message || "Failed to create user.";
        msg.style.color = "red";
      }
    } catch (err) {
      msg.innerText = "Error: " + err.message;
      msg.style.color = "red";
    }
  }

  // ============================
  // DATABASE ‚Äì COLLECTION VIEWER
  // ============================
  async function loadCollection() {
    const collection = document.getElementById("dbCollection").value.trim();
    const dbMsg = document.getElementById("dbMsg");
    const tbody = document.querySelector("#dbTable tbody");

    if (!collection) {
      dbMsg.innerText = "Enter collection name.";
      dbMsg.style.color = "red";
      return;
    }

    dbMsg.innerText = "Loading collection...";
    dbMsg.style.color = "#444";
    tbody.innerHTML = "<tr><td colspan='2' class='text-center'>Loading‚Ä¶</td></tr>";

    try {
      const res = await fetch(`${BASEX_URL}/api/db/all`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ collection })
      });
      const data = await res.json();
      if (!data || !data.docs || !data.docs.length) {
        tbody.innerHTML = "<tr><td colspan='2' class='text-center'>No documents.</td></tr>";
        dbMsg.innerText = "No documents in this collection.";
        dbMsg.style.color = "#777";
        return;
      }

      let rows = "";
      data.docs.forEach(doc => {
        rows += `
          <tr>
            <td>${doc.id}</td>
            <td><pre style="margin:0;font-size:11px;">${JSON.stringify(doc, null, 2)}</pre></td>
          </tr>
        `;
      });
      tbody.innerHTML = rows;
      dbMsg.innerText = `Loaded ${data.docs.length} documents from "${collection}".`;
      dbMsg.style.color = "green";

    } catch (err) {
      tbody.innerHTML = "<tr><td colspan='2' class='text-center'>Error loading.</td></tr>";
      dbMsg.innerText = "Error: " + err.message;
      dbMsg.style.color = "red";
    }
  }

  // INITIAL LOAD
  loadDashboard();
  loadUsersList();
</script>

</body>
</html>
